<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>CreditRegister</title>
    
    <script src="https://wzrd.in/standalone/buffer"></script>
    <script src="https://unpkg.com/ipfs-api@9.0.0/dist/index.js"
    integrity="sha384-5bXRcW9kyxxnSMbOoHzraqa7Z0PQWIao+cgeg327zit1hz5LZCEbIMx/LWKPReuB"
    crossorigin="anonymous"></script>
    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Application -->
    <link href="css/app.css" rel="stylesheet">
</head>

 <script type="text/javascript">
    function uploadInvoice() {
        const reader = new FileReader();
        reader.onloadend = function () {
            //const ipfs = window.IpfsApi('localhost', 5001) // Connect to IPFS
            const ipfs = window.IpfsApi('ipfs.infura.io', 5001, { protocol: 'https' }) // Connect to IPFS
            const buf = buffer.Buffer(reader.result) // Convert data into buffer
            ipfs.files.add(buf, (err, result) => { // Upload buffer to IPFS
                if (err) {
                    console.error(err)
                    return
                }
                let url = `https://ipfs.io/ipfs/${result[0].hash}`
                console.log(`Url --> ${url}`)
                App.processDocument(result[0].hash, "invoice");
            })
        }
        const invoice = document.getElementById("invoice");
        reader.readAsArrayBuffer(invoice.files[0]); // Read Provided File
    }

    function uploadReceipt() {
        const reader = new FileReader();
        reader.onloadend = function () {
            //const ipfs = window.IpfsApi('localhost', 5001) // Connect to IPFS
            const ipfs = window.IpfsApi('ipfs.infura.io', 5001, { protocol: 'https' }) // Connect to IPFS
            const buf = buffer.Buffer(reader.result) // Convert data into buffer
            ipfs.files.add(buf, (err, result) => { // Upload buffer to IPFS
                if (err) {
                    console.error(err)
                    return
                }
                let url = `https://ipfs.io/ipfs/${result[0].hash}`
                console.log(`Url --> ${url}`)
                //muliplier = 1 means receipt
                App.processDocument(result[0].hash, "receipt");
            })
        }
        const receipt = document.getElementById("receipt");
        reader.readAsArrayBuffer(receipt.files[0]); // Read Provided File
    }
</script> 

<body>
    <ul class="nav nav-pills">
        <li class="nav-item">
            <a class="nav-link" href="index.html">Home</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="masterPortal.html">Master Portal</a>
        </li>
        <li class="nav-item">
            <a class="nav-link active" href="businessPortal.html">Business Portal</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="customerPortal.html">Customer Portal</a>
        </li>
    </ul>


    <!-- Modal form to add a customer -->
    <div class="modal fade" id="addCustomer" role="dialog">
        <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Add a customer</h4>
                </div>
                <div class="modal-body">

                    <div class="row">
                        <div class="col-lg-12">
                            <form>
                                <div class="form-group">
                                    <label for="customer_name">Customer name</label>
                                    <input type="text" class="form-control" id="CustomerName" placeholder="Enter the name of the customer to add.">
                                    <label for="customer_address">Customer address</label>
                                    <input type="text" class="form-control" id="CustomerAddress" placeholder="Enter the wallet address of the customer to add.">
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary btn-success" data-dismiss="modal" onclick="App.addCustomer(); return false;">Submit</button>
                    <button type="button" class="btn" data-dismiss="modal">Close</button>
                </div>
            </div>

        </div>
    </div>

    <!-- Modal form to display a customer in console -->
    <div class="modal fade" id="displayCustomer" role="dialog">
        <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Add a customer</h4>
                </div>
                <div class="modal-body">

                    <div class="row">
                        <div class="col-lg-12">
                            <form>
                                <div class="form-group">
                                    <label for="customer_address">Customer address</label>
                                    <input type="text" class="form-control" id="displayCustomerAddress" placeholder="Enter the wallet address of the customer to display.">
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary btn-success" data-dismiss="modal" onclick="App.displayCustomerConsole(); return false;">Submit</button>
                    <button type="button" class="btn" data-dismiss="modal">Close</button>
                </div>
            </div>

        </div>
    </div>


    <!-- Modal form to invoice a customer  -->
    <div class="modal fade" id="invoiceCustomer" role="dialog">
        <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Invoice a customer</h4>
                </div>
                <div class="modal-body">

                    <div class="row">
                        <div class="col-lg-12">
                            <form>
                                <div class="form-group">
                                    <label for="invoice_address">Customer address</label>
                                    <input type="text" class="form-control" id="invoiceCustomerAddress" placeholder="Enter the wallet address of the customer to invoice.">
                                    <label for="invoice_amount">Invoice Amount</label>
                                    <input type="text" class="form-control" id="invoiceAmount" placeholder="Enter the invoice amount.">
                                    <label for="invoice_dueDate">Due Date</label>
                                    <input type="text" class="form-control" id="invoiceDueDate" placeholder="Enter the invoice due date.">
                                    <label for="invoice_upload">Please upload invoice</label>
                                    <input type="file" name="invoice" id="invoice">
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary btn-success" data-dismiss="modal" onclick="uploadInvoice(); return false;">Upload Invoice</button>
                    <button type="button" class="btn" data-dismiss="modal">Close</button>
                </div>
            </div>

        </div>
    </div>
    
    <!-- Modal form to invoice a customer  -->
    <div class="modal fade" id="receiptCustomer" role="dialog">
        <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Receipt a customer</h4>
                </div>
                <div class="modal-body">

                    <div class="row">
                        <div class="col-lg-12">
                            <form>
                                <div class="form-group">
                                    <label for="receipt_address">Customer address</label>
                                    <input type="text" class="form-control" id="receiptCustomerAddress" placeholder="Enter the wallet address of the customer to receipt.">
                                    <label for="receipt_amount">Receipt Amount</label>
                                    <input type="text" class="form-control" id="receiptAmount" placeholder="Enter the receipt amount.">
                                    <label for="receipt_dueDate">Payment Date</label>
                                    <input type="text" class="form-control" id="receiptDueDate" placeholder="Enter the payment date.">
                                    <label for="receipt_upload">Please upload receipt</label>
                                    <input type="file" name="receipt" id="receipt">
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary btn-success" data-dismiss="modal" onclick="uploadReceipt(); return false;">Upload Receipt</button>
                    <button type="button" class="btn" data-dismiss="modal">Close</button>
                </div>
            </div>

        </div>
    </div>

    <!-- Jumbotron showing account details and Add customer button -->
    <div class="container">
        <div class="jumbotron text-center">
            <h1>CreditRegister</h1>
        </div>
        <div class="col-md-12" id="business-list">
            <div class="row">
                <div class="col-lg-12">
                    <p id="message" class="welcome pull-left"></p>
                    <p id="account" class="welcome pull-right"></p>
                    <p id="accountBalance" class="welcome pull-left"></p>
                </div>
            </div>

            <div class="row">
                <button class="btn btn-info btn-lg btn-create" data-toggle="modal" data-target="#addCustomer">Add a
                    customer</button>
                <button class="btn btn-info btn-lg btn-create" data-toggle="modal" data-target="#displayCustomer">Display
                    details in console</button>
                <button class="btn btn-info btn-lg btn-create" data-toggle="modal" onclick="App.displayActiveCustomers(); return false;">Display
                    all customers</button>
                <button class="btn btn-info btn-lg btn-create" data-toggle="modal" data-target="#invoiceCustomer">Invoice
                    customer</button>
                <button class="btn btn-info btn-lg btn-create" data-toggle="modal" data-target="#receiptCustomer">Receipt
                    customer</button>

            </div>

            <div id="customerRow" class="row">
                <!-- CUSTOMERS LOAD HERE -->
            </div>
        </div>

        <div id="customerTemplate" style="display: none;">
            <div class="row-lg-12">
                <div class="panel panel-default panel-article">
                    <div class="panel-heading">
                        <h3 class="customer-name"></h3>
                    </div>
                    <div class="panel-body">
                        <strong>Customer Wallet</strong>:
                        <span class="customer-wallet"></span>
                        <br />
                        <strong>Balance</strong>:
                        <span class="customer-balance"></span>
                    </div>
                    <!--  <div class="panel-footer">
                        <button type="button" class="btn btn-primary btn-success btn-addCustomer" onclick="App.addCustomer(this); return false;">Add Customer</button>
                    </div> -->
                </div>
            </div>
        </div>

    </div>


    <div id="footer" class="container">
        <nav class="navbar navbar-default navbar-fixed-bottom">
            <div class="navbar-inner navbar-content-center text-center">
                <p class="text-muted" credit><a href="https://github.com/bryonySA/Thesis.git">CreditRegister</a> -
                    &copy; 2018 - <a href="https://github.com/bryonySA">Bryony Ortlepp</a></p>
            </div>
        </nav>
    </div>


    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/bootstrap.min.js"></script>
    <script src="https://unpkg.com/ipfs/dist/index.min.js"></script>
    <script src="js/main.js"></script>
</body>

</html>